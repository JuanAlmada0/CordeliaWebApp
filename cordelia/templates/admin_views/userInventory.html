{% extends "base.html" %}

{% block content %}

  <div class="d-flex justify-content-center" style="background-color: #b8a495dc; padding-top: 10px; padding-bottom: 10px;">
    <div class="col-md-2 d-flex flex-column">
      <div class="row pl-3"> 
        <table class="table table-dark flex-1 p-1">

          <thead>
              <tr>
                <td>
                  <span class="text-left neon-text sand" style="font-size: 12.4px;">Database</span>
                </td>

                <td></td>
                
                <td>
                  <button type="submit" class="btn btn-outline-light btn-smaller mr-2 btn-dark">
                    <a href="{{ url_for('admin.downloadExcell') }}" class="text-light">
                        <i class="fas fa-download fa-sm"></i> <!-- Font Awesome download icon, larger size -->
                    </a>
                  </button>                
                </td>
                
              </tr>            
          </thead>
          <tbody>
            <tr>
              <td>
                <a href="{{ url_for('admin.inventory') }}" class="text-left text-light" style="font-size: 12px;">Dress</a>
              </td>            
            </tr>
            <tr>
              <td>
                <a href="{{ url_for('admin.rentInventory') }}" class="text-left text-light" style="font-size: 12px;">Rent</a> 
              </td>
            </tr>
            <tr>
              <td>
                <a href="{{ url_for('admin.userInventory') }}" class="text-left text-light" style="font-size: 12px;">User</a>
                <span class="badge badge-light">{{ inventory.total }}</span>
              </td>
              <td>

              </td>
              <td>
                <a href="{{ url_for('admin.update', title='Add User', form_type='user') }}" class="btn btn-outline-light btn-smaller mr-2 btn-dark">
                  add
                </a>
              </td>
            </tr>
            <table class="table table-dark flex-1 p-1">
              <thead>
                <tr>
                  <td class="text-left">
                    <span class="text-left neon-text sand" style="font-size: 12.4px;">Accounting</span>
                  </td>                     
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <span class="text-left text-light" style="font-size: 12px;">Costs</span>
                  </td>
                </tr>
                <tr>
                  <td>
                    <span class="text-left text-light" style="font-size: 12px;">Earnings</span>
                  </td>
                </tr>
            </table>
          </tbody>
          <tfoot class="custom-footer">
            <tr>
              <td colspan="2">
              </td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>  

    <div class="col-md-10 ml-auto">
      <div class="d-flex justify-content-center">
        <table class="table table-sm table-dark" style="width: 100%;"> 
          <thead>
            <tr>
              <th colspan="2" style="width: 100%; position: relative;">
                <div class="d-flex justify-content-between align-items-center">
                  <span class="text-left text-light" style="font-size: 13px;">
                    <span style="margin-right: 1rem;">User</span>
                  </span>
        
                  <div class="pagination-container">
                    {% if inventory.has_prev or inventory.has_next %}
                    <nav aria-label="Inventory pagination">
                      <ul class="pagination">
                        {% if inventory.has_prev %}
                        <li class="page-item ml-1">
                          <a class="btn btn-outline-light btn-sm btn-smaller btn-dark" href="{{ url_for('admin.userInventory', page=inventory.prev_num, order_by=order_by_column) }}" aria-label="Previous">prev</a>
                        </li>
                        {% endif %}
                        {% for page_num in inventory.iter_pages(left_edge=1, left_current=1, right_current=1, right_edge=1) %}
                        {% if page_num %}
                        <li class="page-item ml-1 {% if page_num == inventory.page %}active{% endif %}">
                          <a class="btn btn-outline-light btn-sm btn-smaller btn-dark" href="{{ url_for('admin.userInventory', page=page_num, order_by=order_by_column) }}">{{ page_num }}</a>
                        </li>
                        {% else %}
                        <li class="page-item ml-2 disabled"><span class="page-link">&hellip;</span></li>
                        {% endif %}
                        {% endfor %}
                        {% if inventory.has_next %}
                        <li class="page-item ml-2">
                          <a class="btn btn-outline-light btn-sm btn-smaller btn-dark" href="{{ url_for('admin.userInventory', page=inventory.next_num, order_by=order_by_column) }}" aria-label="Next">next</a>
                        </li>
                        {% endif %}
                      </ul>
                    </nav>
                    {% endif %}
                  </div>

                  <style>
                    .btn.active {
                      background-color: #817467 !important;
                      border: none !important;
                      color: #000 !important; /* Set the text color to dark */
                    }
                    /* Style the active link inside buttons */
                    .btn.active .text-light {
                      color: #DCC6B6 !important;
                      text-shadow: 0 0 2px #B07D47;
                    }
                    .btn.active:hover {
                      color: #000 !important; /* Set the text color to dark on hover */
                    }
        
                    /* Remove underline from the links inside buttons */
                    .btn.custom-link {
                      text-decoration: none;
                    }
                  </style>
                  
                  <div class="mx-auto">
                    <button type="button" class="ml-2 btn {% if order_by_column == 'default' %}active{% endif %} btn-sm btn-smaller">
                      <a class="text-left text-light custom-link" style="font-size: 12px; font-style: italic;" href="{{ url_for('admin.userInventory', order_by='default') }}">user id</a>
                    </button>
                    <button type="button" class="ml-2 btn {% if order_by_column == 'id' %}active{% endif %} btn-sm btn-smaller">
                      <a class="text-left text-light custom-link" style="font-size: 12px; font-style: italic;" href="{{ url_for('admin.userInventory', order_by='date') }}">joined</a>
                    </button>
                    <button type="button" class="ml-2 btn {% if order_by_column == 'times_rented' %}active{% endif %} btn-sm btn-smaller">
                      <a class="text-left text-light custom-link" style="font-size: 12px; font-style: italic;" href="{{ url_for('admin.userInventory', order_by='name') }}">first name</a>
                    </button>
                    <button type="button" class="ml-2 btn {% if order_by_column == 'dress_cost' %}active{% endif %} btn-sm btn-smaller">
                      <a class="text-left text-light custom-link" style="font-size: 12px; font-style: italic;" href="{{ url_for('admin.userInventory', order_by='last_name') }}">last name</a>
                    </button>
                  </div>  

                  <form method="POST" action="{{ url_for('admin.userInventory') }}" class="form-inline">
                    {{ form.hidden_tag() }}
                    <div class="form-group" style="padding-right: 2.5px;">
                      <style>
                        /* Target the specific field and set the fixed width */
                        #category-input {
                          width: 11em; /* Set the desired width here, for example, 10em */
                        }
                      </style>
                      {{ form.category(class="btn-smaller form-control form-control-sm custom-form-control mr-2", id="category-input", style="width: 12em;", style="background-color: #817568; color: #fff;") }}
                      {{ form.search(class="form-control form-control-sm custom-form-control mr-2", type="search", placeholder="Search", style="background-color: #333; color: #fff;") }}
                      <button type="submit" class="btn btn-outline-light btn-smaller btn-dark">filter</button>
                    </div>
                  </form>
          
                </div>
              </th>
            </tr>
          </thead>                   
          
          <tbody>
          {% for user in inventory.items %}
            <tr>
              <td colspan="2">
                <div class="accordion" id="accordion{{ loop.index }}">
                  <div class="card bg-dark">
                    <div class="card-header" id="heading{{ loop.index }}">
                      <h6 class="mb-0">
                        <div class="row align-items-center">
                          <!-- First column, left part of the card -->
                          <div class="col-md-4">
                            <div class="d-flex justify-content-start">
                              <button class="btn btn-sm" type="button" data-toggle="collapse" data-target="#collapse{{ loop.index }}" aria-expanded="true" aria-controls="collapse{{ loop.index }}">
                                <span class="arrow-down"></span>
                              </button>
                              <div class="text-arrow-container ml-2">
                                <span class="text-left text-light" style="font-size: 13px;">{{ user }}</span>
                              </div>
                            </div>
                          </div>
                        
                          <!-- Second column, middle part of the card -->
                          <div class="col-md-6">
                            <div class="d-flex justify-content-start">
                              <div class="text-arrow-container">
                                <span class="text-left text-light" style="font-size: 13px;">ID : {{ user.id }}</span>
                              </div>
                              <div class="text-arrow-container ml-auto">
                                <span class="text-left text-light" style="font-size: 13px;">{{ user.email }}</span>
                              </div>
                            </div>
                          </div>
                        
                          <!-- Fifth column, delete button -->
                          <div class="col-md-2 d-flex justify-content-end">
                            {% if not user.check_status() %}
                            <form method="POST" action="{{ url_for('admin.delete_object', dataBase='User', id=user.id) }}" class="form-inline" onsubmit="return confirm('Are you sure you want to delete this dress? This action cannot be undone.');">
                              {{ delete_form.hidden_tag() }}
                              <input type="hidden" name="dataBase" value="User">
                              <input type="hidden" name="id" value="{{ user.id }}">
                              <!-- Use the Bootstrap close button here -->
                              <button type="submit" class="btn btn-dark btn-sm btn-smaller text-light" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                              </button>
                            </form>
                            {% elif user.isAdmin or user.check_status() %}
                            <form method="POST" action="{{ url_for('admin.delete_object', dataBase='User', id=user.id) }}" class="form-inline" onsubmit="return false;">
                              {{ delete_form.hidden_tag() }}
                              <input type="hidden" name="dataBase" value="User">
                              <input type="hidden" name="id" value="{{ user.id }}">
                              <!-- Use the Bootstrap close button here -->
                              <button type="submit" class="btn btn-dark btn-sm btn-smaller text-light" aria-label="Close" disabled>
                                <span aria-hidden="true">&times;</span>
                              </button>
                            </form>
                            {% endif %}
                          </div> 
                        </div>
                      </h6>
                    </div>
                  </div>
                </div>

                <div>
                  <div id="collapse{{ loop.index }}" class="collapse" aria-labelledby="heading{{ loop.index }}" data-parent="#accordion{{ loop.index }}">
                    <div class="card-body">
                      <table class="table table-striped table-hover table-sm table-dark">
                        <tbody style="font-size: 15px;">
                          <tr>
                            <td class="d-flex" style="padding-left: 10px;">
                              <!-- Main table column -->
                              <div class="col-4">
                                <!-- Inner table with the content of the rows -->
                                <table class="w-100">
                                  <tbody>
                                    <tr>
                                      <th scope="row">Email:</th>
                                      <td>{{ user.email }}</td>
                                    </tr>
                                    <tr>
                                      <th scope="row">Name:</th>
                                      <td>{{ user.name }}</td>
                                    </tr>
                                    <tr>
                                      <th scope="row">Last Name:</th>
                                      <td>{{ user.lastName }}</td>
                                    </tr>
                                    <tr>
                                      <th scope="row">Phone number:</th>
                                      <td>{{ user.phoneNumber }}</td>
                                    </tr>
                                    <tr>
                                      <th scope="row">Account created:</th>
                                      <td>{{ user.joinedAtDate }}</td>
                                    </tr>
                                  </tbody>
                                </table>
                              </div>
                              <!-- Maintenance log column -->
                              <div class="col-4">
                                <table class="table table-striped table-hover table-sm table-dark">

                                </table>
                              </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>                                                           
                    </div>
                  </div>
                </div>
              </td>
            </tr>
          {% endfor %}
          </tbody>
          <tfoot class="custom-footer">
            <tr>
              <td colspan="2">
              </td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>

{% endblock %}