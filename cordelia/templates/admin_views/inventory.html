{% extends "base.html" %}

{% block content %}

  <style>

    table {
      background: linear-gradient(135deg, #817467 0%, #3d3d3d 100%);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
    }
    .btn-smaller {
      padding: 0.08rem 0.15rem;
      font-size: 0.7rem;
    }
    .custom-btn {
      position: relative;
    }
    .arrow-down {
      border: solid #ffffff;
      border-width: 0 3px 3px 0;
      display: inline-block;
      padding: 2px;
      transform: rotate(45deg);
      -webkit-transform: rotate(45deg);
    }
    /* Custom CSS for reducing space between text and arrow button */
    .text-arrow-container {
      display: flex;
      align-items: center;
    }

    .text-arrow-container .text-left {
      margin-right: 5px; 
    }
    .custom-form-control {
      padding: 0.25rem 0.5rem; 
      font-size: 0.7rem; 
    }
    .custom-footer::before {
      content: ""; /* Empty content */
      display: block;
      height: 20px; 
    }
    .pagination-container {
      position: absolute;
      margin: auto;
      padding-left: 68px;
      padding-top: 15px;
    }
    .content-container {
      background-color: #ad967e;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Subtle box shadow for depth */
      padding: 4px;
    }
    /* Define the styles for the neon text */
    .neon-text {
      font-size: 11px;
      animation: neon 1s infinite;
      display: inline-block;
      margin-right: 10px;
    }
    .green {
      color: #ffffff; 
      text-shadow: 0 0 2px #ffffff;
    }
    .sand {
      color: #DCC6B6; 
      text-shadow: 0 0 2px #B07D47;
    }
    .blue {
      color: #00ffff; 
      text-shadow: 0 0 2px #00ffff;
    }
    .clean-blue {
      color: #00ffc8;
      text-shadow: 0 0 2px #00ffc8;
    }
    .clean-two {
      color: #ff9900;
      text-shadow: 0 0 2px #ff9900;
    }

  </style>


  <div class="d-flex justify-content-center" style="background-color: #b8a495dc; padding-top: 10px; padding-bottom: 10px;">
    <div class="col-md-2 d-flex flex-column">
      <div class="row pl-3"> 
        <table class="table table-dark flex-1 p-1">
          <thead>
            <tr>
              <th>
                <span class="text-left text-light" style="font-size: 12px;">Database</span>
              </th>
              <th>
                <button type="submit" class="btn btn-outline-light btn-smaller mr-2 btn-dark">
                  <a href="{{ url_for('admin.downloadExcell') }}" class="text-light">Download</a>
                </button>
              </th>            
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                <a href="{{ url_for('admin.inventory') }}" class="text-left text-light" style="font-size: 12px;">Dress     .</a> <span class="badge badge-light">{{ inventory.total }}</span>
              </td>
            </tr>
            <tr>
              <td>
                <a href="{{ url_for('admin.rentInventory') }}" class="text-left text-light" style="font-size: 12px;">Rent</a>
              </td>            
            </tr>
            <tr>
              <td>
                <a href="{{ url_for('admin.userInventory') }}" class="text-left text-light" style="font-size: 12px;">User</a>
              </td>
            </tr>
          </tbody>
          <tfoot class="custom-footer">
            <tr>
              <td colspan="2">
              </td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>  

    <div class="col-md-10 ml-auto">
      <div class="d-flex justify-content-center">
        <table class="table table-sm table-dark" style="width: 100%;"> 
          <thead>
            <tr>
              <th colspan="2" style="width: 100%; position: relative;">
                <div class="d-flex justify-content-between align-items-center">
                  <span class="text-left text-light" style="font-size: 14px;">
                    <span style="margin-right: 1rem;">Dress</span>
                  </span>
                  <div class="pagination-container">
                  {% if inventory.has_prev or inventory.has_next %}
                    <nav aria-label="Inventory pagination">
                      <ul class="pagination justify-content-center">
                        {% if inventory.has_prev %}
                        <li class="page-item">
                          <a class="btn btn-outline-light btn-sm btn-smaller btn-dark" href="{{ url_for('admin.inventory', page=inventory.prev_num) }}" aria-label="Previous">prev</a>
                        </li>
                        {% endif %}
                      
                        {% for page_num in inventory.iter_pages(left_edge=1, left_current=1, right_current=1, right_edge=1) %}
                        {% if page_num %}
                        <li class="page-item {% if page_num == inventory.page %}active{% endif %}">
                          <a class="btn btn-outline-light btn-sm btn-smaller btn-dark" href="{{ url_for('admin.inventory', page=page_num) }}">{{ page_num }}</a>
                        </li>
                        {% else %}
                        <li class="page-item disabled"><span class="page-link">&hellip;</span></li>
                        {% endif %}
                        {% endfor %}
                      
                        {% if inventory.has_next %}
                        <li class="page-item">
                          <a class="btn btn-outline-light btn-sm btn-smaller btn-dark" href="{{ url_for('admin.inventory', page=inventory.next_num) }}" aria-label="Next">next</a>
                        </li>
                        {% endif %}
                      </ul>
                    </nav>
                    {% endif %}
                  </div>
                  <div class="ml-auto" style="padding-bottom: 2px;">
                    <a href="{{ url_for('admin.update', title='Add Dress', form_type='dress') }}" class="btn btn-outline-light btn-smaller mr-2 btn-dark">
                        Add Dress
                    </a>
                  </div>              
                  <form method="POST" action="{{ url_for('admin.inventory') }}" class="form-inline">
                    {{ form.hidden_tag() }}
                    <div class="form-group" style="padding-right: 2.5px;">
                      {{ form.category(class="form-control form-control-sm custom-form-control mr-2", id="category-input", style="width: 12em;", style="background-color: #333; color: #fff;") }}
                      {{ form.search(class="form-control form-control-sm custom-form-control mr-2", type="search", placeholder="Search", style="background-color: #333; color: #fff;") }}
                      <button type="submit" class="btn btn-outline-light btn-smaller btn-dark">Filter</button>
                    </div>
                  </form> 
                </div>
              </th>
            </tr>
          </thead>        
          <tbody>
          {% for dress in inventory.items %}
            <tr>
              <td colspan="2">
                <div class="accordion" id="accordion{{ loop.index }}">
                  <div class="card bg-dark">
                    <div class="card-header" id="heading{{ loop.index }}">
                      <h6 class="mb-0">
                        <div class="row align-items-center">
                          <!-- First column, left part of the card -->
                          <div class="col-md-4">
                            <div class="d-flex justify-content-start">
                              <button class="btn btn-sm" type="button" data-toggle="collapse" data-target="#collapse{{ loop.index }}" aria-expanded="true" aria-controls="collapse{{ loop.index }}">
                                <span class="arrow-down"></span>
                              </button>
                              <div class="text-arrow-container ml-2">
                                <span class="text-left text-light" style="font-size: 13px;">{{ dress }}</span>
                              </div>
                            </div>
                          </div>
                        
                          <!-- Second column, middle part of the card -->
                          <div class="col-md-4">
                            <div class="d-flex justify-content-start">
                              <div class="text-arrow-container">
                                <span class="text-left text-light" style="font-size: 13px;">Brand  |  | {{ dress.brand }}</span>
                              </div>
                            </div>
                          </div>

                          <!-- Third column, middle part of the card -->
                          <div class="col-md-1 d-flex justify-content-center">
                            {% if not dress.maintenanceStatus %}
                                <!-- Button to trigger the maintenance form modal -->
                                <div type="button" data-toggle="modal" data-target="#maintenanceModal{{ dress.id }}">
                                    <span class="neon-text blue ml-auto" style="font-size: 11px;">cleaner</span>
                                </div>
                            {% else %}
                                <!-- Button to update maintenance status -->
                                <form action="{{ url_for('admin.update_maintenance_status', dress_id=dress.id) }}" method="post">
                                  {{ form.hidden_tag() }}
                                  <button type="submit" class="neon-text clean-blue" style="background: none; border: none; padding: 0; font-size: 14px;">
                                      @
                                  </button>
                              </form>                                                            
                            {% endif %}
                          </div>
                          
                          <div class="modal fade" id="maintenanceModal{{ dress.id }}" tabindex="-1" role="dialog" aria-labelledby="maintenanceModalLabel{{ dress.id }}" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="maintenanceModalLabel{{ dress.id }}">Maintenance</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <!-- Maintenance form -->
                                        <form method="POST" action="{{ url_for('admin.update_maintenance', dress_id=dress.id) }}" class="form-inline">
                                            {{ maintenance_form.hidden_tag() }}
                                            {{ maintenance_form.dress_id(value=dress.id) }}
                        
                                            <div class="form-group">
                                                {{ maintenance_form.maintenanceDate.label }}
                                                {{ maintenance_form.maintenanceDate(class="form-control") }}
                                            </div>
                        
                                            <div class="form-group">
                                                {{ maintenance_form.maintenanceCost.label }}
                                                {{ maintenance_form.maintenanceCost(class="form-control", type="number") }}
                                            </div>
                        
                                            <div class="form-group">
                                                <button type="submit" class="btn btn-primary btn-dark" value="Submit">Submit</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                          </div>
                        
                          <!-- Fourth column, sellable badge -->
                          <div class="col-md-1 d-flex justify-content-center">
                            {% if dress.sellable %}
                              <span class="neon-text sand" style="font-size: 12px;">sellable</span>
                            {% else %}
                              <span class="text text-dark" style="font-size: 12px;">{{ dress.sellable }}</span>
                            {% endif %}
                          </div>

                          <div class="col-md-1 d-flex justify-content-center">
                            {% if not dress.rentStatus %}
                              {% if not dress.maintenanceStatus %}
                                <span class="neon-text sand" style="font-size: 12px;">stock</span>
                              {% else %}
                                <span class="neon-text clean-blue" style="font-size: 12px;">@cleaning</span>
                              {% endif %}
                            {% else %}
                              <span class="neon-text clean-two" style="font-size: 12px;">rented</span>
                            {% endif %}
                          </div>
                        
                          <!-- Fourth column, availability badge -->
                          <div class="col-md-1 d-flex justify-content-end">
                            {% if not dress.rentStatus and not dress.maintenanceStatus %}
                            <form method="POST" action="{{ url_for('admin.delete_object', dataBase='Dress', id=dress.id) }}" class="form-inline" onsubmit="return confirm('Are you sure you want to delete this dress? This action cannot be undone.');">
                              {{ delete_form.hidden_tag() }}
                              <input type="hidden" name="dataBase" value="Dress">
                              <input type="hidden" name="id" value="{{ dress.id }}">
                              <!-- Bootstrap close button -->
                              <button type="submit" class="btn btn-dark btn-sm btn-smaller text-light" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                              </button>
                            </form>
                            {% else %}
                            <form method="POST" action="{{ url_for('admin.delete_object', dataBase='Dress', id=dress.id) }}" class="form-inline" onsubmit="return false;">
                              {{ delete_form.hidden_tag() }}
                              <input type="hidden" name="dataBase" value="Dress">
                              <input type="hidden" name="id" value="{{ dress.id }}">
                              <!-- Bootstrap close button -->
                              <button type="submit" class="btn btn-dark btn-sm btn-smaller text-light" aria-label="Close" disabled>
                                <span aria-hidden="true">&times;</span>
                              </button>
                            </form>
                            {% endif %}
                          </div>                                            
                        </div>
                      </h6>
                    </div>
                  </div>
                </div>

                <div>
                  <div id="collapse{{ loop.index }}" class="collapse" aria-labelledby="heading{{ loop.index }}" data-parent="#accordion{{ loop.index }}">
                    <div class="card-body">
                      <table class="table table-striped table-hover table-sm table-dark">
                        <tbody style="font-size: 15px;">
                          <tr>
                            <td class="d-flex" style="padding-left: 10px;">
                              <!-- Main table column -->
                              <div class="col-4">
                                <!-- Inner table with the content of the rows -->
                                <table class="w-100">
                                  <tbody>
                                    <tr>
                                      <th scope="row">Date Added:</th>
                                      <td>{{ dress.dateAdded.strftime('%Y-%m-%d') }}</td>
                                    </tr>
                                    <tr>
                                      <th scope="row">Rent for:</th>
                                      <td>{{ dress.rentPrice }}</td>
                                    </tr>
                                    <tr>
                                      <th scope="row">Size:</th>
                                      <td>{{ dress.size }}</td>
                                    </tr>
                                    <tr>
                                      <th scope="row">Color:</th>
                                      <td>{{ dress.color }}</td>
                                    </tr>
                                    <tr>
                                      <th scope="row">Style:</th>
                                      <td>{{ dress.style }}</td>
                                    </tr>
                                    <tr>
                                      <th scope="row">Dress Cost:</th>
                                      <td>{{ dress.dressCost }}</td>
                                    </tr>
                                    <tr>
                                      <th scope="row">Market Price:</th>
                                      <td>{{ dress.marketPrice }}</td>
                                    </tr>
                                    <tr>
                                      <th scope="row">Rents for returns:</th>
                                      <td>{{ dress.rentsToReturnInvestment }}</td>
                                    </tr>
                                    <tr>
                                      <th scope="row">Times Rented:</th>
                                      <td>{{ dress.timesRented }}</td>
                                    </tr>
                                    <tr>
                                      <th scope="row">In maintenance:</th>
                                      <td>{{ dress.maintenanceStatus }}</td>
                                    </tr>
                                  </tbody>
                                </table>
                              </div>
                              <!-- Maintenance log column -->
                              <div class="col-4">
                                <table class="table table-striped table-hover table-sm table-dark">
                                  <thead style="font-size: 14px;">
                                    <tr>
                                      <th>Log Date</th>
                                      <th>Maintenance Cost</th>
                                    </tr>
                                  </thead>
                                  <tbody style="font-size: 13px;">
                                  {% if dress.maintenanceLog %}
                                    {% for log in dress.get_maintenance_log() %}
                                    <tr>
                                        <td>{{ log.date }}</td>
                                        <td>$ {{ log.cost }}</td>
                                    </tr>
                                    {% endfor %}
                                  {% endif %}
                                  </tbody>
                                </table>
                              </div>
                              <!-- Image column -->
                              <div class="col-4 text-center">
                                <img src="{{ url_for('static', filename='images/cordelia-logo.png') }}" alt="..." class="img-thumbnail" style="max-width: 100%; height: auto;">
                              </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>                                                           
                    </div>
                  </div>
                </div>
              </td>
            </tr>
          {% endfor %}
          </tbody>
          <tfoot class="custom-footer">
            <tr>
              <td colspan="2">
              </td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>

{% endblock %}