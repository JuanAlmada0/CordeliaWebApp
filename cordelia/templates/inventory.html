{% extends "base.html" %}

{% block welcome_message %}
    <p class="nav-link mb-0 font-weight-normal">DASHBOARD</p>
{% endblock %}

{% block content %}

<style>
  .custom-bg {
    color: #B07D47;
  }

  .btn-smaller {
    padding: 0.1rem 0.3rem;
    font-size: 0.7rem;
  }
  .custom-btn {
    position: relative;
  }
  .arrow-down {
    border: solid #ffffff;
    border-width: 0 3px 3px 0;
    display: inline-block;
    padding: 2px;
    transform: rotate(45deg);
    -webkit-transform: rotate(45deg);
  }
  /* Custom CSS for reducing space between text and arrow button */
  .text-arrow-container {
    display: flex;
    align-items: center;
  }

  .text-arrow-container .text-left {
    margin-right: 5px; 
  }
  .custom-form-control {
    padding: 0.25rem 0.5rem; 
    font-size: 0.7rem; 
  }
  .custom-footer::before {
    content: ""; /* Empty content */
    display: block;
    height: 20px; 
  }
  .pagination-container {
    position: absolute;
    margin: auto;
    padding-left: 68px;
    padding-top: 15px;
  }
</style>

</br>

<div class="d-flex justify-content-center" style="background-color: #b8a495dc; padding-top: 10px; padding-bottom: 10px;">
  <div class="col-md-2 d-flex flex-column">
    <div class="row pl-3"> 
      <table class="table table-dark flex-1 p-1">
        <thead>
          <tr>
            <th>
              <span class="text-left text-light" style="font-size: 12px;">Database</span>
            </th>
            <th>
              <button type="submit" class="btn btn-outline-light btn-smaller mr-2">
                <a href="{{ url_for('admin.downloadExcell') }}" class="text-light">Download</a>
              </button>
            </th>            
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <a href="{{ url_for('admin.inventory') }}" class="text-left text-light" style="font-size: 12px;">Dress     .</a> <span class="badge badge-light">{{ inventory.total }}</span>
            </td>
          </tr>
          <tr>
            <td>
              <a href="{{ url_for('admin.rentInventory') }}" class="text-left text-light" style="font-size: 12px;">Rent</a>
            </td>            
          </tr>
          <tr>
            <td>
              <a href="{{ url_for('admin.userInventory') }}" class="text-left text-light" style="font-size: 12px;">User</a>
            </td>
          </tr>
        </tbody>
        <tfoot class="custom-footer">
          <tr>
            <td colspan="2">
            </td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>  

  <div class="col-md-10 ml-auto">
    <div class="d-flex justify-content-center">
      <table class="table table-sm table-dark" style="width: 100%;"> 
        <thead class="custom-bg">
          <tr>
            <th colspan="2" style="width: 100%; position: relative;">
              <div class="d-flex justify-content-between align-items-center">
                <span class="text-left text-light" style="font-size: 14px;">
                  <span style="margin-right: 1rem;">Dress</span>
                </span>
                <div class="pagination-container">
                {% if inventory.has_prev or inventory.has_next %}
                  <nav aria-label="Inventory pagination">
                    <ul class="pagination justify-content-center">
                      {% if inventory.has_prev %}
                      <li class="page-item">
                        <a class="badge badge-dark" href="{{ url_for('admin.inventory', page=inventory.prev_num) }}" aria-label="Previous">prev</a>
                      </li>
                      {% endif %}
                    
                      {% for page_num in inventory.iter_pages(left_edge=1, left_current=1, right_current=1, right_edge=1) %}
                      {% if page_num %}
                      <li class="page-item {% if page_num == inventory.page %}active{% endif %}">
                        <a class="btn btn-outline-light btn-sm btn-smaller" href="{{ url_for('admin.inventory', page=page_num) }}">{{ page_num }}</a>
                      </li>
                      {% else %}
                      <li class="page-item disabled"><span class="page-link">&hellip;</span></li>
                      {% endif %}
                      {% endfor %}
                    
                      {% if inventory.has_next %}
                      <li class="page-item">
                        <a class="badge badge-dark" href="{{ url_for('admin.inventory', page=inventory.next_num) }}" aria-label="Next">next</a>
                      </li>
                      {% endif %}
                    </ul>
                  </nav>
                  {% endif %}
                </div>
                <div class="ml-auto">
                  <button type="submit" class="btn btn-outline-light btn-smaller mr-2">
                    <a href="{{ url_for('admin.update') }}" class="text-light">Add dress</a>
                  </button>
                </div>
                <form method="POST" action="{{ url_for('admin.inventory') }}" class="form-inline">
                  {{ form.hidden_tag() }}
                  <div class="form-group" style="padding-right: 2.5px;">
                    {{ form.category(class="form-control form-control-sm custom-form-control mr-2", id="category-input", style="width: 12em;", style="background-color: #333; color: #fff;") }}
                    {{ form.search(class="form-control form-control-sm custom-form-control mr-2", type="search", placeholder="Search", style="background-color: #333; color: #fff;") }}
                    <button type="submit" class="btn btn-outline-light btn-smaller">Filter</button>
                  </div>
                </form> 
              </div>
            </th>
          </tr>
        </thead>        
        <tbody class="custom-bg">
          {% for dress in inventory.items %}
          <tr>
            <td colspan="2">
              <div class="accordion" id="accordion{{ loop.index }}">
                <div class="card bg-secondary">
                  <div class="card-header" id="heading{{ loop.index }}">
                    <h6 class="mb-0">
                      <div class="row align-items-center">
                        <!-- First column, left part of the card -->
                        <div class="col-md-4">
                          <div class="d-flex justify-content-start">
                            <button class="btn btn-sm" type="button" data-toggle="collapse" data-target="#collapse{{ loop.index }}" aria-expanded="true" aria-controls="collapse{{ loop.index }}">
                              <span class="arrow-down"></span>
                            </button>
                            <div class="text-arrow-container ml-2">
                              <span class="text-left text-light" style="font-size: 13px;">{{ dress }}</span>
                            </div>
                          </div>
                        </div>
                      
                        <!-- Second column, middle part of the card -->
                        <div class="col-md-4">
                          <div class="d-flex justify-content-start">
                            <div class="text-arrow-container">
                              <span class="text-left text-light" style="font-size: 13px;">Brand | {{ dress.brand }}</span>
                            </div>
                          </div>
                        </div>

                        <div class="col-md-1 d-flex justify-content-center">
                          {% if not dress.maintenanceStatus %}
                            <form method="POST" action="{{ url_for('admin.update_maintenance', dress_id=dress.id) }}" class="form-inline">
                              {{ maintenance_form.csrf_token }}
                              {{ maintenance_form.dress_id(value=dress.id) }}
                              <button type="submit" class="btn btn-secondary btn-sm btn-smaller text-light">
                                <span class="text text-light" style="font-size: 12px;">Maintenance</span>
                              </button>
                            </form>
                          {% else %}
                            <form method="POST" action="{{ url_for('admin.update_maintenance', dress_id=dress.id) }}" class="form-inline">
                              {{ maintenance_form.csrf_token }}
                              {{ maintenance_form.dress_id(value=dress.id) }}
                              <button type="submit" class="btn btn-secondary btn-sm btn-smaller text-light">
                                <span class="badge badge-pill badge-warning badge-small" style="font-size: 12px;">In Maintenance</span>
                              </button>
                            </form>
                          {% endif %}
                        </div>                        
                      
                        <!-- Third column, sellable badge -->
                        <div class="col-md-1 d-flex justify-content-center">
                          {% if dress.sellable %}
                            <span class="badge badge-pill badge-dark badge-small" style="font-size: 12px;">Sellable</span>
                          {% else %}
                            <span class="text text-secondary" style="font-size: 12px;">Not Sellable</span>
                          {% endif %}
                        </div>

                        <div class="col-md-1 d-flex justify-content-center">
                          {% if not dress.rentStatus %}
                            <span class="badge badge-pill badge-light badge-small" style="font-size: 12px;">Available</span>
                          {% else %}
                            <span class="badge badge-pill badge-info badge-small" style="font-size: 12px;">Rented</span>
                          {% endif %}
                        </div>
                      
                        <!-- Fourth column, availability badge -->
                        <div class="col-md-1 d-flex justify-content-end">
                          {% if not dress.rentStatus %}
                          <form method="POST" action="{{ url_for('admin.delete_dress', dress_id=dress.id) }}" class="form-inline" onsubmit="return confirm('Are you sure you want to delete this dress? This action cannot be undone.');">
                            {{ form.hidden_tag() }}
                            <input type="hidden" name="dress_id" value="{{ dress.id }}">
                            <!-- Use the Bootstrap close button here -->
                            <button type="submit" class="btn btn-secondary btn-sm btn-smaller text-light" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                            </button>
                          </form>
                          {% else %}
                          <form method="POST" action="{{ url_for('admin.delete_dress', dress_id=dress.id) }}" class="form-inline" onsubmit="return false;">
                            {{ form.hidden_tag() }}
                            <input type="hidden" name="dress_id" value="{{ dress.id }}">
                            <!-- Use the Bootstrap close button here -->
                            <button type="submit" class="btn btn-secondary btn-sm btn-smaller text-light" aria-label="Close" disabled>
                              <span aria-hidden="true">&times;</span>
                            </button>
                          </form>
                          {% endif %}
                        </div>                                            
                      </div>
                    </h6>
                  </div>
                </div>
              </div>
              <div>
                <div id="collapse{{ loop.index }}" class="collapse" aria-labelledby="heading{{ loop.index }}" data-parent="#accordion{{ loop.index }}">
                  <div class="card-body">
                    <table class="table table-striped table-hover table-sm table-secondary">
                      <tbody style="font-size: 15px;">
                        <tr>
                          <th scope="row">Rent for :</th>
                          <td>{{ dress.rentPrice }}</td>
                        </tr>
                        <tr>
                          <th scope="row">Size:</th>
                          <td>{{ dress.size }}</td>
                        </tr>
                        <tr>
                          <th scope="row">Color:</th>
                          <td>{{ dress.color }}</td>
                        </tr>
                        <tr>
                          <th scope="row">Style:</th>
                          <td>{{ dress.style }}</td>
                        </tr>
                        <tr>
                          <th scope="row">Dress Cost:</th>
                          <td>{{ dress.dressCost }}</td>
                        </tr>
                        <tr>
                          <th scope="row">Market Price:</th>
                          <td>{{ dress.marketPrice }}</td>
                        </tr>
                        <tr>
                          <th scope="row">Rents to return Investment:</th>
                          <td>{{ dress.rentsToReturnInvestment }}</td>
                        </tr>
                        <tr>
                          <th scope="row">Times Rented:</th>
                          <td>{{ dress.timesRented }}</td>
                        </tr>
                        <tr>
                          <th scope="row">In maintenance:</th>
                          <td>{{ dress.maintenanceStatus }}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
        <tfoot class="custom-footer">
          <tr>
            <td colspan="2">
            </td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>

{% endblock %}